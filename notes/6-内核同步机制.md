# 内核同步机制（简单介绍）

## 关于同步理论的一些基本概念
- 临界区（critical area）：访问或操作共享数据的代码段。简单理解就是synchronied打括号中的部分（原子性）
- 竞争条件（race condition）两个线程同时拥有林攫取的执行权
- 数据不一致：data unconsistency 有竞争条件引起的数据破坏
- 同步 （synchronization） 避免race conditions
- 锁：完成同步的手段（门锁，门后是临界区，只允许一个线程存在）上锁解所必须具备原子性。Lock指令，需要底层的支持
- 原子性：像原子一样不可分割的操作
- 有序性：禁止指令重排
- 可见性：一个线程内修改，另一个线程可见

## 内核同步常用方法
原子性、有序性、可见性  
1、原子操作 - 内核中类似AtomicXXX，位于linux/types.h cmpxchg原语提供了原子性操作  
2、自旋锁 - 内核中通过汇编支持CAS，位于asm/spinloc.h. 上面一种从原语层面上就支持，无需自旋，所以这一种比上一种效率稍低
3、读写自旋 - 类似于ReadWriteLock，Read锁是一个共享锁，Write锁是一个独占锁，可以同时读，只能一个写。只有写操作完成并进行通知之后，所有
   等待的读操作才能继续执行（写操作之间依靠synchronized关键进行），这样做的目的是使读操作能读取到正确的数据，不会出现脏读。改用读写锁实现
   上述功能，只需要在读操作时获取读锁，写操作时获取锁即可。当写锁被获取到时，后续（非当前写操作线程）的读写操作都会被阻塞，写锁释放之后，所有
   操作继续执行，

## 汇编实现引导程序